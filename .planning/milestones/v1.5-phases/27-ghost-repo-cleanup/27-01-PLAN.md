---
phase: 27-ghost-repo-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - CLAUDE.md
autonomous: true
requirements:
  - REPO-01
  - REPO-02

must_haves:
  truths:
    - "All 6 repos (audit, billing-service, device-service, identity-service, infra, ingestion-service) are archived on GitHub and reject pushes"
    - "Each archived repo has a README pointing to the main trustedge workspace"
    - "CLAUDE.md contains a table documenting what each ghost repo was intended to become"
  artifacts:
    - path: "CLAUDE.md"
      provides: "Ghost repo scope documentation section"
      contains: "Archived Service Repos"
  key_links:
    - from: "CLAUDE.md"
      to: "GitHub TrustEdge-Labs org"
      via: "documentation of archived repo intent"
      pattern: "audit.*billing.*device.*identity.*infra.*ingestion"
---

<objective>
Archive 6 empty scaffold repos under TrustEdge-Labs and document their intended scope in CLAUDE.md.

Purpose: These repos were created for a planned microservice SaaS architecture (open-core model) that v1.5 replaced with a monolithic approach. Archiving removes confusion about active repos; documenting preserves institutional knowledge.

Output: 6 archived GitHub repos with redirect READMEs; CLAUDE.md updated with scope table.
</objective>

<execution_context>
@/home/john/.claude/get-shit-done/workflows/execute-plan.md
@/home/john/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-ghost-repo-cleanup/27-CONTEXT.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify repos are scaffolds and document scope in CLAUDE.md</name>
  <files>CLAUDE.md</files>
  <action>
For each of the 6 repos under github.com/TrustEdge-Labs, run a quick API check to verify they are truly scaffolds:

```bash
for repo in audit billing-service device-service identity-service infra ingestion-service; do
  echo "=== $repo ==="
  gh api repos/TrustEdge-Labs/$repo --jq '{name: .name, archived: .archived, size: .size, default_branch: .default_branch}'
  gh api "repos/TrustEdge-Labs/$repo/git/trees/$( gh api repos/TrustEdge-Labs/$repo --jq .default_branch )?recursive=1" --jq '.tree | length' 2>/dev/null || echo "tree: error"
  gh api "repos/TrustEdge-Labs/$repo/commits?per_page=1" --jq 'length' 2>/dev/null || echo "commits: error"
done
```

**Meaningful code threshold (Claude's discretion):** A repo with more than 10 non-config files (excluding README, LICENSE, .gitignore, Cargo.toml template) OR more than 5 commits is considered "meaningful" and should be flagged and skipped.

If ALL repos are scaffolds, add a new section to CLAUDE.md. Insert it after the "## Architecture Overview" section (after the Data Flow subsection, before "## Code Standards"). Use this format:

```markdown
### Archived Service Repos

These repos under TrustEdge-Labs were scaffolds for a planned microservice SaaS platform (open-core model). They were archived in v1.5 after consolidating into the monolithic trustedge-platform crate.

| Repo | Intended Scope | Current Status |
|------|---------------|----------------|
| audit | Audit trail service for compliance logging | Not implemented, deferred |
| billing-service | Subscription and usage billing for SaaS customers | Not implemented, deferred |
| device-service | Device registration and management API | Consolidated into trustedge-platform (postgres feature) |
| identity-service | Authentication and identity management | Consolidated into trustedge-platform (http/postgres features) |
| infra | Infrastructure-as-code and deployment configs | Not implemented, deferred |
| ingestion-service | Data ingestion pipeline for device telemetry | Not implemented, deferred |
```

Adjust the "Intended Scope" and "Current Status" columns based on what you observe from the repo contents and the consolidation work done in Phases 24-26. The table above is a starting template -- use your judgment on exact wording.

If any repo has meaningful code, note it in the plan summary and skip that repo from the CLAUDE.md table (mark it separately with a note that it needs manual review).
  </action>
  <verify>
1. All 6 repos verified as scaffolds (or flagged for manual review)
2. CLAUDE.md contains the "Archived Service Repos" section with a table
3. `cargo build --workspace` still passes (CLAUDE.md is not compiled, but verify no accidental file corruption)
  </verify>
  <done>CLAUDE.md has a table documenting all 6 ghost repos with their intended scope and current status. Any repo with meaningful code has been flagged instead of documented as a scaffold.</done>
</task>

<task type="auto">
  <name>Task 2: Update READMEs and archive all 6 repos on GitHub</name>
  <files></files>
  <action>
For each scaffold repo confirmed in Task 1 (skip any flagged repos):

**Step 1: Update README with redirect notice.** Use the GitHub API to update each repo's README.md:

```bash
for repo in audit billing-service device-service identity-service infra ingestion-service; do
  # Get current README SHA (needed for update)
  SHA=$(gh api repos/TrustEdge-Labs/$repo/contents/README.md --jq '.sha' 2>/dev/null)

  CONTENT=$(echo -n "# $repo

Archived. See [trustedge](https://github.com/TrustEdge-Labs/trustedge) main workspace." | base64 -w 0)

  if [ -n "$SHA" ]; then
    # Update existing README
    gh api repos/TrustEdge-Labs/$repo/contents/README.md \
      -X PUT \
      -f message="docs: archive notice — see trustedge main workspace" \
      -f content="$CONTENT" \
      -f sha="$SHA"
  else
    # Create README if none exists
    gh api repos/TrustEdge-Labs/$repo/contents/README.md \
      -X PUT \
      -f message="docs: archive notice — see trustedge main workspace" \
      -f content="$CONTENT"
  fi
done
```

**Step 2: Archive each repo** using the GitHub API:

```bash
for repo in audit billing-service device-service identity-service infra ingestion-service; do
  gh api repos/TrustEdge-Labs/$repo \
    -X PATCH \
    -F archived=true
  echo "Archived: $repo"
done
```

**Step 3: Verify archival** by checking the archived status:

```bash
for repo in audit billing-service device-service identity-service infra ingestion-service; do
  gh api repos/TrustEdge-Labs/$repo --jq '{name: .name, archived: .archived}'
done
```

All 6 repos should show `"archived": true`.
  </action>
  <verify>
1. Each repo's README contains the redirect notice (check via `gh api repos/TrustEdge-Labs/{repo}/contents/README.md --jq '.content' | base64 -d`)
2. Each repo shows `archived: true` from the GitHub API
3. Attempting to push to an archived repo is rejected by GitHub
  </verify>
  <done>All 6 scaffold repos have updated READMEs pointing to the main workspace and are archived on GitHub (archived=true, pushes rejected).</done>
</task>

</tasks>

<verification>
1. `gh api repos/TrustEdge-Labs/audit --jq .archived` returns `true` (repeat for all 6)
2. CLAUDE.md contains "Archived Service Repos" section with 6-row table
3. `cargo build --workspace` passes (no workspace breakage)
4. `cargo test --workspace` passes (no test regression)
</verification>

<success_criteria>
- All 6 repos archived on GitHub and no longer accept pushes
- Each repo has a README redirecting to the main trustedge workspace
- CLAUDE.md documents the intended scope of each archived repo in a table
- Zero test regressions in the main workspace
</success_criteria>

<output>
After completion, create `.planning/phases/27-ghost-repo-cleanup/27-01-SUMMARY.md`
</output>
