---
phase: 29-dashboard-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/dashboard/package.json
  - web/dashboard/svelte.config.js
  - web/dashboard/vite.config.js
  - web/dashboard/tsconfig.json
  - web/dashboard/.gitignore
  - web/dashboard/.env.example
  - web/dashboard/src/app.html
  - web/dashboard/src/app.css
  - web/dashboard/src/lib/api.ts
  - web/dashboard/src/lib/config.ts
  - web/dashboard/src/lib/types.ts
  - web/dashboard/src/lib/components/ErrorBanner.svelte
  - web/dashboard/src/lib/components/JsonViewer.svelte
  - web/dashboard/src/lib/components/KeyValue.svelte
  - web/dashboard/src/lib/components/StatusPill.svelte
  - web/dashboard/src/routes/+layout.svelte
  - web/dashboard/src/routes/+page.svelte
  - web/dashboard/src/routes/devices/+page.svelte
  - web/dashboard/src/routes/receipts/+page.svelte
  - web/dashboard/src/routes/receipts/[id]/+page.svelte
  - CLAUDE.md
autonomous: true
requirements:
  - WEB-01
  - WEB-02

must_haves:
  truths:
    - "web/dashboard/ contains all dashboard source files from the external repo"
    - "npm run dev succeeds from web/dashboard/ without errors"
    - "npm run build succeeds from web/dashboard/ without errors"
    - "CLAUDE.md documents the dashboard build/dev commands"
    - "No references to an external dashboard repo location remain in the workspace"
  artifacts:
    - path: "web/dashboard/package.json"
      provides: "SvelteKit project configuration"
      contains: "trustedge-dashboard"
    - path: "web/dashboard/src/routes/+page.svelte"
      provides: "Dashboard home page"
      contains: "TrustEdge Dashboard"
    - path: "web/dashboard/src/lib/config.ts"
      provides: "API configuration"
      contains: "localhost:3001"
    - path: "web/dashboard/src/lib/api.ts"
      provides: "API client class"
      contains: "ApiClient"
    - path: "CLAUDE.md"
      provides: "Updated project instructions with dashboard section"
      contains: "web/dashboard"
  key_links:
    - from: "web/dashboard/src/lib/api.ts"
      to: "web/dashboard/src/lib/config.ts"
      via: "import { config }"
      pattern: "import.*config.*from.*config"
    - from: "web/dashboard/src/routes/+page.svelte"
      to: "web/dashboard/src/lib/config.ts"
      via: "import { config }"
      pattern: "import.*config"
---

<objective>
Move the trustedge-dashboard SvelteKit app into `web/dashboard/` and verify it builds.

Purpose: Consolidate the dashboard from its external repo (TrustEdge-Labs/trustedge-dashboard) into the monorepo so all TrustEdge code lives in one place. This is the "move" step -- type generation follows in plan 02.

Output: A fully functional SvelteKit app at `web/dashboard/` that builds and runs with `npm run dev` / `npm run build`. CLAUDE.md updated with dashboard instructions.
</objective>

<execution_context>
@/home/john/.claude/get-shit-done/workflows/execute-plan.md
@/home/john/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-dashboard-consolidation/29-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clone dashboard files into web/dashboard/</name>
  <files>
    web/dashboard/package.json
    web/dashboard/svelte.config.js
    web/dashboard/vite.config.js
    web/dashboard/tsconfig.json
    web/dashboard/.gitignore
    web/dashboard/.env.example
    web/dashboard/src/app.html
    web/dashboard/src/app.css
    web/dashboard/src/lib/api.ts
    web/dashboard/src/lib/config.ts
    web/dashboard/src/lib/types.ts
    web/dashboard/src/lib/components/ErrorBanner.svelte
    web/dashboard/src/lib/components/JsonViewer.svelte
    web/dashboard/src/lib/components/KeyValue.svelte
    web/dashboard/src/lib/components/StatusPill.svelte
    web/dashboard/src/routes/+layout.svelte
    web/dashboard/src/routes/+page.svelte
    web/dashboard/src/routes/devices/+page.svelte
    web/dashboard/src/routes/receipts/+page.svelte
    web/dashboard/src/routes/receipts/[id]/+page.svelte
  </files>
  <action>
    Clone the TrustEdge-Labs/trustedge-dashboard repo into a temporary directory, then copy all source files (excluding node_modules, .git, dist/build artifacts, .env, .env.local) into `web/dashboard/`.

    Use `gh repo clone TrustEdge-Labs/trustedge-dashboard /tmp/trustedge-dashboard-clone` to get the files, then copy the directory structure preserving all paths.

    Files to copy from repo root: package.json, svelte.config.js, vite.config.js, tsconfig.json, .gitignore, .env.example
    Files to copy from src/: all files and subdirectories (app.html, app.css, lib/, routes/)

    Do NOT copy: node_modules/, .git/, build/, .svelte-kit/, .env, .env.local, .env.*.local, README.md (will not be needed in monorepo context), CLAUDE.md (dashboard-specific CLAUDE.md is superseded by root CLAUDE.md)

    After copying, update `web/dashboard/src/lib/config.ts` to change the default API base URL from `http://localhost:3000` to `http://localhost:3001` per user decision (production config is out of scope).

    Then run `cd web/dashboard && npm install` to generate node_modules and package-lock.json. The package-lock.json should be committed (for reproducible builds). Add `node_modules/` to web/dashboard/.gitignore if not already present.

    Clean up the temp clone: `rm -rf /tmp/trustedge-dashboard-clone`
  </action>
  <verify>
    Run `cd web/dashboard && npm run build` -- must exit 0 with no errors.
    Run `ls web/dashboard/src/lib/types.ts` -- file must exist.
    Run `ls web/dashboard/src/routes/devices/+page.svelte` -- file must exist.
    Verify config.ts contains `localhost:3001` (not 3000).
  </verify>
  <done>
    All dashboard source files exist under web/dashboard/, npm install has run, npm run build succeeds, API base URL defaults to localhost:3001.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CLAUDE.md with dashboard section</name>
  <files>
    CLAUDE.md
  </files>
  <action>
    Read the current CLAUDE.md and add a Dashboard section to the "Build & Test Commands" area. Insert it after the existing build/test commands block, before the "Architecture Overview" section.

    Add this content:

    ```
    ### Dashboard (web/dashboard/)

    ```bash
    # Install dependencies
    cd web/dashboard && npm install

    # Development server
    cd web/dashboard && npm run dev

    # Production build
    cd web/dashboard && npm run build

    # Type checking
    cd web/dashboard && npm run check
    ```

    The dashboard is a SvelteKit app that provides a web UI for managing devices and viewing verification receipts. It connects to the platform server API at the URL configured in `.env.local` (defaults to `http://localhost:3001`).
    ```

    Also update the "Architecture Overview" section to mention the dashboard. In the section after "Archive System (.trst format):", add:

    ```
    **Web Dashboard:**
    - `web/dashboard/` - SvelteKit admin dashboard for device management and receipt viewing
    ```

    Also update the note about trustedge-dashboard that currently says "(SvelteKit frontend, ~139 LOC) is deferred to a future milestone and not archived" -- this is now stale. Remove or replace this note. The dashboard is no longer deferred; it has been moved into the monorepo.

    Specifically, in the "Archived Service Repos" section, find the note:
    > Note: A planned `trustedge-audit` (compliance logging) repo was never created. The trustedge-dashboard (SvelteKit frontend, ~139 LOC) is deferred to a future milestone and not archived.

    Replace it with:
    > Note: A planned `trustedge-audit` (compliance logging) repo was never created. The trustedge-dashboard has been moved into `web/dashboard/` in the main workspace.
  </action>
  <verify>
    Run `grep -c 'web/dashboard' CLAUDE.md` -- must be >= 3 (multiple references).
    Run `grep 'npm run dev' CLAUDE.md` -- must find the dashboard dev command.
    Run `grep 'deferred' CLAUDE.md | grep -c 'dashboard'` -- must be 0 (no more "deferred" references to dashboard).
  </verify>
  <done>
    CLAUDE.md contains a Dashboard section with build/dev/check commands, mentions web/dashboard/ in architecture, and no longer refers to the dashboard as deferred.
  </done>
</task>

</tasks>

<verification>
1. `cd web/dashboard && npm run build` exits 0
2. `cd web/dashboard && npm run check` exits 0 (TypeScript types valid)
3. All expected files exist: package.json, svelte.config.js, src/lib/types.ts, src/routes/+page.svelte, src/routes/devices/+page.svelte, src/routes/receipts/+page.svelte, src/routes/receipts/[id]/+page.svelte
4. `grep 'localhost:3001' web/dashboard/src/lib/config.ts` finds the updated URL
5. `grep 'web/dashboard' CLAUDE.md` finds dashboard documentation
</verification>

<success_criteria>
- web/dashboard/ contains all dashboard source files (configs, lib, routes, components)
- `npm run build` succeeds from web/dashboard/
- config.ts defaults to localhost:3001
- CLAUDE.md documents dashboard commands and mentions web/dashboard/ in architecture
- No stale references to "deferred" dashboard in CLAUDE.md
</success_criteria>

<output>
After completion, create `.planning/phases/29-dashboard-consolidation/29-01-SUMMARY.md`
</output>
