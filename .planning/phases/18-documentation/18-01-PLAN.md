---
phase: 18-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [DEPENDENCIES.md]
autonomous: true

must_haves:
  truths:
    - "DEPENDENCIES.md documents all 10 workspace crates"
    - "Every dependency in every Cargo.toml has a one-line justification in DEPENDENCIES.md"
    - "Security-critical dependencies (crypto, TLS, key storage) have multi-sentence rationale"
    - "v1.3 changes reflected (pkcs11 removed, feature gating, cargo-audit acceptance)"
  artifacts:
    - path: "DEPENDENCIES.md"
      provides: "Complete dependency documentation for all 10 crates"
      contains: "trustedge-pubky"
    - path: "DEPENDENCIES.md"
      provides: "Security rationale section"
      contains: "Security-Critical"
  key_links:
    - from: "DEPENDENCIES.md"
      to: "crates/*/Cargo.toml"
      via: "dependency table entries"
      pattern: "every dependency listed in Cargo.toml appears in DEPENDENCIES.md"
---

<objective>
Rewrite DEPENDENCIES.md to comprehensively document every dependency across all 10 workspace crates, with security-critical rationale for crypto/TLS/key-storage dependencies.

Purpose: Satisfy DOC-01, DOC-02, DOC-03 requirements and close out v1.3 milestone. The existing DEPENDENCIES.md (from v1.2) only covers 5 stable crates and has stale entries (pkcs11 listed but was removed in Phase 16).

Output: Complete DEPENDENCIES.md covering all 10 crates with per-dependency justifications and a dedicated security rationale section.
</objective>

<execution_context>
@/home/john/.claude/get-shit-done/workflows/execute-plan.md
@/home/john/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@DEPENDENCIES.md
@Cargo.toml
@crates/core/Cargo.toml
@crates/trustedge-cli/Cargo.toml
@crates/trst-protocols/Cargo.toml
@crates/trst-cli/Cargo.toml
@crates/trst-wasm/Cargo.toml
@crates/wasm/Cargo.toml
@crates/pubky/Cargo.toml
@crates/pubky-advanced/Cargo.toml
@crates/receipts/Cargo.toml
@crates/attestation/Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite DEPENDENCIES.md with all 10 crates and per-dependency justifications</name>
  <files>DEPENDENCIES.md</files>
  <action>
Rewrite DEPENDENCIES.md from scratch. The current file (from v1.2) only covers 5 stable crates and has stale entries. The new version must:

**Structure:**
1. Header: title, last-audited date (today), milestone (v1.3), scope (all 10 crates)
2. Table of contents linking to each crate section
3. One section per crate (10 sections total), organized as:
   - **Stable tier first (5):** trustedge-core, trustedge-cli, trustedge-trst-protocols, trustedge-trst-cli, trustedge-trst-wasm
   - **Experimental tier second (5):** trustedge-wasm, trustedge-pubky, trustedge-pubky-advanced, trustedge-receipts, trustedge-attestation
4. Each crate section has a dependency table: | Dependency | Version | Justification | Status |
5. Each dependency has a one-line justification (DOC-02)
6. Workspace dependency summary section at the end

**For the 5 stable crates:** Carry forward the existing justifications from the current DEPENDENCIES.md, but apply these corrections:
- REMOVE pkcs11 from trustedge-core table (was removed in Phase 16, commit 202787c)
- UPDATE git2 status to "Used (optional, feature: git-attestation)" (was feature-gated in Phase 15)
- UPDATE keyring status to "Used (optional, feature: keyring)" (was feature-gated in Phase 15)
- KEEP all other entries as-is (they are accurate)
- KEEP the "Tokio features used" notes for core and trst-cli
- KEEP the crypto-duplication note for trustedge-cli

**For the 5 experimental crates, read each crate's Cargo.toml and write justifications:**

trustedge-wasm (crates/wasm/Cargo.toml):
- wasm-bindgen: Rust/JS interop for WASM bindings
- js-sys: JavaScript standard library bindings
- serde + serde_json: JSON serialization for WASM API
- aes-gcm: AES-256-GCM encryption in browser
- rand: Random number generation for crypto ops
- getrandom: WASM RNG support (js feature activation) -- note false positive
- base64: Base64 encoding/decoding for key material
- console_error_panic_hook: Better panic messages in browser console
- Status: all "Used"

trustedge-pubky (crates/pubky/Cargo.toml):
- trustedge-core: Core library dependency
- pubky: Pubky network client for key publishing/resolution
- anyhow: Error handling for CLI binary
- tokio: Async runtime for Pubky network operations
- serde + serde_json: JSON serialization for Pubky messages
- hex: Hex encoding for key display
- thiserror: Structured error types
- rand: Random number generation
- clap: CLI argument parsing for trustedge-pubky binary
- Status: all "Used"

trustedge-pubky-advanced (crates/pubky-advanced/Cargo.toml):
- trustedge-core: Core library dependency
- pubky: Pubky network client
- ed25519-dalek: Ed25519 signing for hybrid encryption
- x25519-dalek: X25519 ECDH key agreement
- aes-gcm: AES-256-GCM for hybrid encryption
- hkdf: HKDF key derivation for hybrid encryption
- blake3: Hashing for key derivation
- sha2: SHA-256 for HKDF (used directly, not workspace)
- serde + serde_json + bincode: Serialization for hybrid messages
- anyhow: Error handling
- hex: Hex encoding for keys
- zeroize: Secure memory zeroing for key material
- rand: Random number generation
- thiserror: Structured error types
- tokio: Async runtime
- reqwest: HTTP client for Pubky network operations
- Status: all "Used"

trustedge-receipts (crates/receipts/Cargo.toml):
- trustedge-core: Re-export facade (deprecated, removal planned August 2026)
- Status: "Used (facade)"

trustedge-attestation (crates/attestation/Cargo.toml):
- trustedge-core: Re-export facade (deprecated, removal planned August 2026)
- Status: "Used (facade)"

**Remove from the document:**
- The "Findings" section (stale from v1.2, findings no longer relevant)
- The "Changes Made (2026-02-12)" section (historical, superseded)
- The "Recommendations for Future Work" section (completed or no longer relevant)

**Add to the document:**
- A "Workspace Dependency Summary" section listing all [workspace.dependencies] from root Cargo.toml
- A note about the 2-tier crate classification (stable vs experimental)
  </action>
  <verify>
1. Count crate sections: grep -c "^## trustedge-" DEPENDENCIES.md should return 10
2. Check experimental crates present: grep "trustedge-pubky\|trustedge-wasm\|trustedge-receipts\|trustedge-attestation\|trustedge-pubky-advanced" DEPENDENCIES.md should show all 5
3. Check pkcs11 removed: grep "pkcs11" DEPENDENCIES.md should return 0 matches
4. Check git2 updated: grep "git-attestation" DEPENDENCIES.md should match
5. Check keyring updated: grep "feature: keyring" DEPENDENCIES.md should match
  </verify>
  <done>
DEPENDENCIES.md covers all 10 crates with per-dependency justification tables. Stale v1.2 content removed. v1.3 changes (pkcs11 removal, feature gating) reflected. DOC-01 and DOC-02 satisfied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add security-critical dependency rationale section</name>
  <files>DEPENDENCIES.md</files>
  <action>
Add a "Security-Critical Dependency Rationale" section to DEPENDENCIES.md (after the last crate section, before the workspace summary). This satisfies DOC-03.

For each security-critical dependency, write 3-5 sentences covering: what it does, why it was chosen over alternatives, how TrustEdge uses it, and any known security considerations.

**Cryptographic primitives:**

1. **aes-gcm** (AES-256-GCM): Core encryption primitive for envelope encryption. Used in trustedge-core for per-chunk encryption of input data, in trustedge-cli for direct cipher operations, and in WASM crates for browser-side encryption. Chosen as the industry-standard authenticated encryption algorithm. Part of the RustCrypto ecosystem which undergoes regular security review.

2. **chacha20poly1305** (XChaCha20-Poly1305): Alternative AEAD cipher used in crypto.rs module. Provides stream cipher encryption as complement to AES-GCM. Used in trst-cli for archive chunk encryption. Chosen for its constant-time implementation and resistance to timing attacks on platforms without AES-NI hardware acceleration.

3. **ed25519-dalek** (Ed25519): Core signing primitive. Used for envelope signing, mutual authentication, archive signature verification, and hybrid encryption in Pubky. Chosen for its small key size (32 bytes), fast verification, and resistance to many classes of implementation attacks. The dalek library is the most widely audited Rust Ed25519 implementation.

4. **blake3**: Cryptographic hash function. Used for continuity chain hashing, manifest verification, and key derivation. Chosen over SHA-256 for performance (parallelizable, SIMD-optimized) while maintaining 256-bit security. Used across core, cli, trst-cli, and pubky-advanced.

5. **rsa**: RSA asymmetric encryption. Used ONLY in Pubky hybrid encryption (experimental) and YubiKey PIV operations (feature-gated). NOT used in core production encryption path (which is Ed25519 + AES-256-GCM). Known advisory RUSTSEC-2023-0071 (Marvin Attack) accepted with risk documentation in .cargo/audit.toml since TrustEdge does not use RSA for decryption timing-sensitive operations.

6. **p256** (NIST P-256 ECDH): Used in Software HSM backend for ECDH key agreement. Provides P-256 elliptic curve operations for backends that require NIST-approved algorithms.

7. **x25519-dalek** (X25519): Used in trustedge-pubky-advanced for Diffie-Hellman key agreement in hybrid encryption. Provides modern elliptic curve key exchange complementing Ed25519 signing.

8. **hkdf**: HMAC-based Key Derivation Function. Used in pubky-advanced for deriving symmetric keys from ECDH shared secrets. Industry-standard KDF specified in RFC 5869.

9. **pbkdf2**: Password-based key derivation. Used in keyring backend for deriving encryption keys from stored secrets. Provides intentionally slow key derivation to resist brute-force attacks.

**TLS and transport security:**

10. **rustls**: TLS implementation for QUIC transport. Pure-Rust TLS 1.3 library, chosen over OpenSSL bindings for portability and memory safety. Used by quinn for QUIC connection encryption.

11. **quinn**: QUIC transport protocol implementation. Provides encrypted, multiplexed connections for TrustEdge's network transport layer. Built on rustls for TLS 1.3 support.

**Key storage and hardware security:**

12. **keyring** (feature-gated): OS keyring integration for secure key storage. Provides cross-platform access to macOS Keychain, Windows Credential Manager, and Linux Secret Service. Feature-gated behind `keyring` flag to avoid platform-specific dependencies in default builds.

13. **yubikey** (feature-gated): YubiKey hardware security module interface. Provides PIV (Personal Identity Verification) operations for hardware-backed key storage and signing. Feature-gated behind `yubikey` flag. Depends on system PCSC daemon for hardware communication.

14. **zeroize**: Secure memory zeroing for cryptographic key material. Ensures keys are wiped from memory after use, preventing cold-boot and memory-dump attacks. Used across core, cli, and pubky-advanced for all key types.

15. **rcgen** (feature-gated): X.509 certificate generation for YubiKey operations. Generates self-signed certificates for PIV slot operations. Only compiled with yubikey feature.
  </action>
  <verify>
1. grep "Security-Critical Dependency Rationale" DEPENDENCIES.md should match
2. Count security entries: grep -c "^\*\*[0-9]" DEPENDENCIES.md -- should be >= 15
3. Check RSA rationale mentions advisory: grep "RUSTSEC-2023-0071" DEPENDENCIES.md should match
4. Check zeroize rationale exists: grep "cold-boot" DEPENDENCIES.md should match
5. Check rustls rationale exists: grep "TLS 1.3" DEPENDENCIES.md should match
  </verify>
  <done>
DEPENDENCIES.md has a dedicated "Security-Critical Dependency Rationale" section with multi-sentence justifications for all crypto, TLS, and key-storage dependencies. DOC-03 satisfied.
  </done>
</task>

</tasks>

<verification>
**Overall phase verification:**
1. DOC-01: `grep -c "^## trustedge-" DEPENDENCIES.md` returns 10 (all crates covered)
2. DOC-02: Every dependency in every crate's Cargo.toml has a matching entry in DEPENDENCIES.md -- cross-reference by reading each Cargo.toml [dependencies] section and checking DEPENDENCIES.md
3. DOC-03: `grep "Security-Critical Dependency Rationale" DEPENDENCIES.md` matches, section contains 15+ entries with multi-sentence rationale
4. Accuracy: pkcs11 not present (removed Phase 16), git2 and keyring show feature-gated status (Phase 15), RSA advisory documented (Phase 17)
5. Build still passes: `cargo build --workspace` (documentation-only change, but verify nothing accidentally modified)
</verification>

<success_criteria>
- DEPENDENCIES.md covers all 10 workspace crates with dependency tables
- Every dependency has a one-line justification
- Security-critical dependencies have 3-5 sentence detailed rationale
- v1.3 changes (pkcs11 removal, feature gating, cargo-audit) accurately reflected
- No stale v1.2 content remains
</success_criteria>

<output>
After completion, create `.planning/phases/18-documentation/18-01-SUMMARY.md`
</output>
