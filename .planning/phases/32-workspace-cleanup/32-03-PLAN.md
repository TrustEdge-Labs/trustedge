---
phase: 32-workspace-cleanup
plan: 03
type: execute
wave: 3
depends_on: ["32-01", "32-02"]
files_modified:
  - scripts/ci-check.sh
  - .github/workflows/ci.yml
  - CLAUDE.md
  - README.md
  - DEPENDENCIES.md
  - FEATURES.md
  - MIGRATION.md
  - CHANGELOG.md
autonomous: true
requirements:
  - WRK-02

must_haves:
  truths:
    - "ci-check.sh has no references to trustedge-receipts, trustedge-attestation, trustedge-pubky, or trustedge-pubky-advanced"
    - "ci.yml has no references to the removed or moved crates"
    - "ci-check.sh uses a single clippy/test pass for all workspace crates (no tiered logic)"
    - "CLAUDE.md Architecture Overview reflects the actual workspace (no facades, no pubky in main workspace)"
    - "DEPENDENCIES.md has no sections for deleted or moved crates"
    - "README.md crate table matches actual workspace membership"
    - "Dependency tree baseline in ci-check.sh matches the actual post-cleanup count"
  artifacts:
    - path: "scripts/ci-check.sh"
      provides: "Simplified CI without tiered logic or removed crate references"
    - path: ".github/workflows/ci.yml"
      provides: "GitHub Actions CI without removed crate references"
    - path: "CLAUDE.md"
      provides: "Architecture Overview matching actual workspace"
    - path: "README.md"
      provides: "Crate table matching actual workspace"
    - path: "DEPENDENCIES.md"
      provides: "Dependency audit for current crates only"
  key_links:
    - from: "scripts/ci-check.sh"
      to: "Cargo.toml"
      via: "crate package names in cargo commands"
      pattern: "-p trustedge-"
    - from: ".github/workflows/ci.yml"
      to: "Cargo.toml"
      via: "crate package names in cargo commands"
      pattern: "-p trustedge-"
---

<objective>
Update all CI scripts and documentation to reflect the new workspace reality after facade deletion and pubky isolation.

Purpose: CI scripts and docs still reference deleted crates and use tiered logic that is no longer needed. Per user decision, do "section rewrite, not surgical removal" -- rewrite entire affected sections to reflect the new reality. Remove tiered CI (core blocking, experimental non-blocking) since the only crates in the workspace are Tier 1 stable crates. Update dep tree baseline to the new, smaller count.
Output: All CI and documentation files are consistent with the current workspace state.
</objective>

<execution_context>
@/home/john/.claude/get-shit-done/workflows/execute-plan.md
@/home/john/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-workspace-cleanup/32-01-SUMMARY.md
@.planning/phases/32-workspace-cleanup/32-02-SUMMARY.md
@scripts/ci-check.sh
@.github/workflows/ci.yml
@CLAUDE.md
@README.md
@DEPENDENCIES.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Simplify CI scripts (ci-check.sh and ci.yml)</name>
  <files>scripts/ci-check.sh, .github/workflows/ci.yml</files>
  <action>
**ci-check.sh changes:**

1. Step 4 (Clippy tiered): Replace the two-pass tiered approach with a single clippy call for all workspace crates. Remove the "core crates" and "experimental crates" split. The new Step 4 should clippy ALL workspace crates in one call since they are all stable:
   ```bash
   step "Step 4: Clippy (workspace)"
   if cargo clippy --workspace --all-targets --no-default-features -- -D warnings; then
       pass "clippy workspace"
   else
       fail "clippy workspace"
   fi
   ```
   Keep the separate platform feature combination clippy (Step 4b) since that tests specific feature combos.

2. Step 11 (Build + test tiered): Same simplification. Remove "core crate tests" and "experimental crate tests" split. Replace with:
   - Single `cargo build --workspace --bins --no-default-features`
   - Single `cargo test --workspace --no-default-features --locked` (or list the crates explicitly if `--workspace` tests too many; the key point is removing the experimental tier pass)
   - Keep the separate platform test block (it tests specific features)

3. Step 19 (WASM): Remove `trustedge-wasm` from the WASM check if it was only experimental. Actually, trustedge-wasm is still a workspace member (it's Tier 2 but still in workspace). Check root Cargo.toml members to see if trustedge-wasm is still there. If it is, keep the WASM check for trustedge-wasm and trustedge-trst-wasm.

4. Step 21 (Dep tree): Update the `baseline` variable to the new count from Plan 02's recorded value. The SUMMARY from Plan 02 will have the actual count. Use that number as the new baseline.

5. Remove all comments referencing "tiered", "core blocking, experimental non-blocking", "Tier 1", "Tier 2".

**ci.yml changes:**

1. Remove the "clippy (experimental crates - non-blocking)" step entirely (it referenced trustedge-pubky, trustedge-pubky-advanced, trustedge-receipts, trustedge-attestation).

2. Remove the "tests (experimental crates - non-blocking)" step entirely.

3. The "clippy (core crates)" step can be renamed to just "clippy (workspace)" and use `cargo clippy --workspace` instead of listing individual crates. Or keep listing crates explicitly for clarity -- either way, remove the deleted/moved crate names.

4. Update the dep tree baseline in the "Dependency tree size check" step to match the new count.

5. Add trustedge-types and trustedge-platform to the core clippy step if they are not already there (trustedge-types is missing from ci.yml clippy core). Check current ci.yml and ensure all workspace members are covered.
  </action>
  <verify>
- `grep -c 'trustedge-receipts\|trustedge-attestation\|trustedge-pubky' scripts/ci-check.sh` returns 0
- `grep -c 'trustedge-receipts\|trustedge-attestation\|trustedge-pubky' .github/workflows/ci.yml` returns 0
- `grep -c 'experimental' scripts/ci-check.sh` returns 0 (no tiered logic)
- `grep -c 'continue-on-error' .github/workflows/ci.yml` returns 0 for experimental-related steps
- `./scripts/ci-check.sh` runs successfully (or at least the non-hardware steps pass)
  </verify>
  <done>CI scripts reference only current workspace members. Tiered logic is removed. Dep tree baseline reflects the post-cleanup count.</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite documentation sections (CLAUDE.md, README.md, DEPENDENCIES.md, FEATURES.md, MIGRATION.md)</name>
  <files>CLAUDE.md, README.md, DEPENDENCIES.md, FEATURES.md, MIGRATION.md, CHANGELOG.md</files>
  <action>
**CLAUDE.md changes:**
1. Architecture Overview section: Update crate count (was 12, now should reflect actual count after removing facades and moving pubky). List only the crates that are in the root workspace. Remove the "Pubky Network Integration" subsection that listed trustedge-pubky and trustedge-pubky-advanced. Add a brief note like: "Experimental crates (trustedge-pubky, trustedge-pubky-advanced) live in `crates/experimental/` as a separate workspace."
2. Remove trustedge-receipts and trustedge-attestation from the crate list and any mentions in the text (e.g., "deprecated facade crates" bullet points).
3. Update the "Build & Test Commands" section if it mentions experimental crates.
4. Drop Tier 1/Tier 2 language throughout.

**README.md changes:**
1. Rewrite the crate table to list only root workspace crates. Remove rows for trustedge-attestation, trustedge-receipts, trustedge-pubky, trustedge-pubky-advanced.
2. Add a brief note that experimental crates exist under `crates/experimental/`.
3. Remove any "deprecated facade" language.

**DEPENDENCIES.md changes:**
1. Remove the "Experimental Tier" section from the Table of Contents.
2. Delete the entire sections for: trustedge-pubky, trustedge-pubky-advanced, trustedge-receipts, trustedge-attestation.
3. Update the "Workspace Dependency Summary" section: remove deps that were cleaned in Plan 02 (pubky, and any others removed).
4. Update the "Note on Crate Classification" to reflect the new structure (no tiers, just "workspace crates" and "experimental crates in separate workspace").
5. Update the header metadata (scope, crate count).

**FEATURES.md changes:**
1. Remove the `trustedge-attestation` section (it described a `symbols` feature).
2. Remove any references to experimental or facade crates.

**MIGRATION.md changes:**
1. If it references migrating from trustedge-receipts or trustedge-attestation, add a final note that these crates have been removed entirely. Keep migration guidance brief since the crates were never published.

**CHANGELOG.md changes:**
1. Do NOT add a new entry yet (that happens at milestone completion). Just ensure no existing entries create broken references.
  </action>
  <verify>
- `grep -c 'trustedge-receipts\|trustedge-attestation' CLAUDE.md` returns 0
- `grep -c 'Tier 1\|Tier 2' CLAUDE.md` returns 0
- `grep -c 'trustedge-receipts\|trustedge-attestation' README.md` returns 0
- `grep -c 'trustedge-receipts\|trustedge-attestation' DEPENDENCIES.md` returns 0
- `grep -c 'trustedge-receipts\|trustedge-attestation' FEATURES.md` returns 0
- The crate count in CLAUDE.md matches the actual workspace member count in Cargo.toml
  </verify>
  <done>All documentation files reflect the current workspace structure. No references to deleted or moved crates remain in CI-visible or developer-facing docs. Tier classification language is removed.</done>
</task>

</tasks>

<verification>
- `grep -rn 'trustedge-receipts\|trustedge-attestation' scripts/ .github/ CLAUDE.md README.md DEPENDENCIES.md FEATURES.md MIGRATION.md` returns no matches
- `grep -rn 'trustedge-pubky' scripts/ .github/` returns no matches
- `./scripts/ci-check.sh` completes without referencing removed crates
- CLAUDE.md Architecture Overview crate count matches actual workspace members
- DEPENDENCIES.md has no sections for removed/moved crates
</verification>

<success_criteria>
All CI scripts and documentation files are consistent with the post-cleanup workspace. No references to deleted facades or moved pubky crates remain in any CI or documentation file. The tiered CI approach is replaced with a single-tier model for the root workspace.
</success_criteria>

<output>
After completion, create `.planning/phases/32-workspace-cleanup/32-03-SUMMARY.md`
</output>
