---
phase: 08-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/08-validation/VALIDATION-REPORT.md
autonomous: true

must_haves:
  truths:
    - "Test count matches or exceeds Phase 1 baseline (348 tests minimum)"
    - "No API breakage detected from consolidation (cargo-semver-checks passes)"
    - "All-features CI step executed successfully (not skipped)"
    - "WASM build verification executed successfully (not skipped)"
    - "Build time baseline established and documented"
  artifacts:
    - path: ".planning/phases/08-validation/VALIDATION-REPORT.md"
      provides: "Comprehensive validation results"
      min_lines: 100
      contains: ["Test Count Validation", "API Compatibility", "Build Time"]
  key_links:
    - from: "scripts/test-inventory.sh"
      to: "VALIDATION-REPORT.md"
      via: "test count extraction"
      pattern: "grep.*test result"
    - from: "cargo-semver-checks"
      to: "VALIDATION-REPORT.md"
      via: "API compatibility verification"
      pattern: "semver-checks.*baseline-rev"
---

<objective>
Validate that workspace consolidation (Phases 1-7) preserved all functionality, API compatibility, and test coverage.

Purpose: Verify the integrity of the consolidation effort before declaring success. This plan validates the three critical preservation guarantees: test count, API compatibility, and build performance.

Output: VALIDATION-REPORT.md documenting comprehensive validation results with pass/fail for each criterion.
</objective>

<execution_context>
@/home/john/.claude/get-shit-done/workflows/execute-plan.md
@/home/john/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-validation/08-RESEARCH.md
@.planning/phases/01-foundation/TEST-BASELINE.md
@.planning/phases/06-feature-flags/06-02-SUMMARY.md
@scripts/ci-check.sh
@scripts/test-inventory.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Test count validation and comparison to baseline</name>
  <files>.planning/phases/08-validation/VALIDATION-REPORT.md</files>
  <action>
Run the test inventory script and compare against Phase 1 baseline (348 tests):

1. Execute test count extraction:
   ```bash
   cargo test --workspace --no-fail-fast 2>&1 | grep -E "test result:" | awk '{sum+=$4} END {print sum}'
   ```

2. Run full test inventory script:
   ```bash
   ./scripts/test-inventory.sh .planning/phases/08-validation/TEST-COUNT-CURRENT.txt
   ```

3. Compare counts:
   - BASELINE: 348 tests (from Phase 1)
   - EXPECTED: 348+ tests (receipts and attestation tests moved to core, no tests should be lost)
   - RESULT: Document actual count and pass/fail

4. Validate test distribution:
   - trustedge-core should have ~291+ tests (258 baseline + 23 receipts + 10 attestation)
   - Facade crates (receipts, attestation) may have 0 tests (re-exports only)
   - Other crates unchanged from baseline

5. Create VALIDATION-REPORT.md with Test Count Validation section:
   - Baseline: 348 tests
   - Current: [actual count]
   - Status: PASS (≥348) or FAIL (<348)
   - Details: Per-crate breakdown comparing to baseline
   - Notes: Expected increase from test migration

Do NOT treat facade crate test count drops as failures - tests were intentionally moved to core. Focus on workspace total.
  </action>
  <verify>
   ```bash
   # Verify report exists and has test count section
   grep -q "Test Count Validation" .planning/phases/08-validation/VALIDATION-REPORT.md

   # Verify current test count file exists
   test -f .planning/phases/08-validation/TEST-COUNT-CURRENT.txt

   # Verify workspace total documented
   grep -q "Current:.*test" .planning/phases/08-validation/VALIDATION-REPORT.md
   ```
  </verify>
  <done>
VALIDATION-REPORT.md exists with Test Count Validation section showing baseline (348), current count, and pass/fail status. TEST-COUNT-CURRENT.txt contains full test inventory.
  </done>
</task>

<task type="auto">
  <name>Task 2: API compatibility verification with cargo-semver-checks</name>
  <files>.planning/phases/08-validation/VALIDATION-REPORT.md</files>
  <action>
Verify API compatibility using cargo-semver-checks with HEAD~1 baseline:

1. Run semver-checks on trustedge-core (the consolidation target):
   ```bash
   cargo semver-checks --package trustedge-core --baseline-rev HEAD~1 2>&1 | tee .planning/phases/08-validation/SEMVER-CORE.txt || echo "Expected on first run"
   ```

2. Run semver-checks on facade crates (should show deprecation as only change):
   ```bash
   cargo semver-checks --package trustedge-receipts --baseline-rev HEAD~1 2>&1 | tee .planning/phases/08-validation/SEMVER-RECEIPTS.txt || true
   cargo semver-checks --package trustedge-attestation --baseline-rev HEAD~1 2>&1 | tee .planning/phases/08-validation/SEMVER-ATTESTATION.txt || true
   ```

3. Document results in VALIDATION-REPORT.md API Compatibility section:
   - For each crate: PASS (no breaking changes detected) or FAIL (with specific violations listed)
   - Expected outcome: Core has no breaking changes, facades show deprecation warnings only
   - Note: Deprecation warnings are acceptable and expected from Phase 7

4. If breaking changes detected in core:
   - Document specific violations (function signature changes, removed public items, etc.)
   - Mark as validation failure - consolidation should not break APIs

Reminder: HEAD~1 baseline strategy was chosen in Phase 1 for unpublished crates. First-run "no baseline" warnings are acceptable.
  </action>
  <verify>
   ```bash
   # Verify semver check outputs exist
   test -f .planning/phases/08-validation/SEMVER-CORE.txt
   test -f .planning/phases/08-validation/SEMVER-RECEIPTS.txt
   test -f .planning/phases/08-validation/SEMVER-ATTESTATION.txt

   # Verify API compatibility section in report
   grep -q "API Compatibility" .planning/phases/08-validation/VALIDATION-REPORT.md
   ```
  </verify>
  <done>
VALIDATION-REPORT.md has API Compatibility section documenting semver-checks results for core and facade crates. SEMVER-*.txt files contain raw output from cargo-semver-checks.
  </done>
</task>

<task type="auto">
  <name>Task 3: CI execution verification and build time baseline</name>
  <files>.planning/phases/08-validation/VALIDATION-REPORT.md</files>
  <action>
Verify CI steps executed and establish build time baseline:

1. Verify all-features CI step executed (from Phase 6 success criterion):
   - Check that Step 12 in ci-check.sh is not skipped
   - Document platform dependency availability (ALSA, PCSC)
   - If all-features skipped: note as WARNING (not FAILURE) - platform dependencies may be unavailable

2. Verify WASM build verification executed (from Phase 6 success criterion):
   - Check that wasm32-unknown-unknown target installed
   - Run WASM build check:
     ```bash
     if rustup target list --installed | grep -q wasm32-unknown-unknown; then
       cargo check -p trustedge-wasm --target wasm32-unknown-unknown 2>&1 | tee .planning/phases/08-validation/WASM-CORE.txt
       cargo check -p trustedge-trst-wasm --target wasm32-unknown-unknown 2>&1 | tee .planning/phases/08-validation/WASM-TRST.txt
       echo "PASS"
     else
       echo "SKIP: wasm32-unknown-unknown not installed"
     fi
     ```

3. Establish build time baseline (Phase 1 did not capture):
   - Measure clean workspace build time:
     ```bash
     cargo clean
     time cargo build --workspace --release 2>&1 | tee .planning/phases/08-validation/BUILD-TIME.txt
     ```
   - Extract compilation time from "Finished" output
   - Document as POST-CONSOLIDATION BASELINE (not compared to pre-consolidation)
   - Declare acceptable if <5 minutes (typical for workspace this size)
   - Future validations should not exceed 2x this baseline

4. Document in VALIDATION-REPORT.md CI Execution and Build Time sections:
   - All-features status: PASS/SKIP with reason
   - WASM verification: PASS/SKIP with reason
   - Build time: [duration] (baseline established)
   - Note: SKIP is acceptable if platform dependencies unavailable

Research findings indicate Phase 1 did not capture pre-consolidation build time. This establishes the post-consolidation baseline.
  </action>
  <verify>
   ```bash
   # Verify CI execution section exists
   grep -q "CI Execution" .planning/phases/08-validation/VALIDATION-REPORT.md

   # Verify build time section exists
   grep -q "Build Time" .planning/phases/08-validation/VALIDATION-REPORT.md

   # Verify build time measurement file exists
   test -f .planning/phases/08-validation/BUILD-TIME.txt
   ```
  </verify>
  <done>
VALIDATION-REPORT.md has CI Execution and Build Time sections documenting all-features status, WASM verification status, and post-consolidation build time baseline. BUILD-TIME.txt contains raw build output with timing.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Verify VALIDATION-REPORT.md exists and contains all required sections:
   - Test Count Validation (baseline vs current)
   - API Compatibility (semver-checks results)
   - CI Execution (all-features and WASM status)
   - Build Time (post-consolidation baseline)

2. Verify supporting artifacts exist:
   - TEST-COUNT-CURRENT.txt (full test inventory)
   - SEMVER-CORE.txt, SEMVER-RECEIPTS.txt, SEMVER-ATTESTATION.txt
   - WASM-CORE.txt, WASM-TRST.txt (if WASM target available)
   - BUILD-TIME.txt (build timing output)

3. Check overall validation status:
   - Test count ≥348: Required for PASS
   - No API breakage in core: Required for PASS
   - All-features and WASM: SKIP acceptable if dependencies unavailable
   - Build time <5 min: Reasonable for workspace size

4. Run validation verification:
   ```bash
   grep -E "PASS|FAIL|SKIP" .planning/phases/08-validation/VALIDATION-REPORT.md
   ```
</verification>

<success_criteria>
1. VALIDATION-REPORT.md exists with comprehensive results across all validation dimensions
2. Test count validation shows ≥348 tests preserved (VAL-01)
3. cargo-semver-checks shows no breaking changes in trustedge-core API
4. All-features and WASM verification status documented (may be SKIP if platform dependencies unavailable)
5. Build time baseline established and documented as acceptable (<5 min)
6. Supporting evidence files (test counts, semver outputs, build timing) committed to git
</success_criteria>

<output>
After completion, create `.planning/phases/08-validation/08-01-SUMMARY.md` documenting:
- Validation results summary (pass/fail for each criterion)
- Test count comparison (baseline vs current)
- API compatibility status
- CI execution verification results
- Build time baseline established
- Next steps: Plan 08-02 for unused dependency cleanup
</output>
