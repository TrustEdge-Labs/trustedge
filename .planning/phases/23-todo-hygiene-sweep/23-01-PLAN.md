---
phase: 23-todo-hygiene-sweep
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/core/src/audio.rs
  - crates/trustedge-cli/src/main.rs
  - scripts/ci-check.sh
  - .github/workflows/ci.yml
autonomous: true

must_haves:
  truths:
    - "Zero TODO/FIXME comments indicating unimplemented functionality exist in Rust source files"
    - "All cfg-gated feature stubs use clear fail-closed terminology instead of ambiguous 'stub' wording"
    - "CI rejects new unimplemented TODO comments on every push and PR"
  artifacts:
    - path: "scripts/ci-check.sh"
      provides: "TODO hygiene check step"
      contains: "TODO.*unimplemented\\|TODO.*not yet\\|FIXME\\|HACK\\|XXX"
    - path: ".github/workflows/ci.yml"
      provides: "TODO hygiene CI step"
      contains: "TODO hygiene"
  key_links:
    - from: "scripts/ci-check.sh"
      to: ".github/workflows/ci.yml"
      via: "Matching TODO scan logic"
      pattern: "TODO.*unimplemented"
---

<objective>
Finalize TODO hygiene across the codebase: confirm zero unimplemented-functionality TODOs remain, improve doc-comment clarity on cfg-gated feature stubs, and add CI guardrails preventing future TODO regression.

Purpose: This is the FINAL phase of the v1.4 milestone. Prior phases (19-22) eliminated all unimplemented TODO comments. This phase validates the clean state, improves documentation clarity, and adds CI enforcement.

Output: Clean codebase with CI-enforced TODO hygiene policy.
</objective>

<execution_context>
@/home/john/.claude/get-shit-done/workflows/execute-plan.md
@/home/john/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@crates/core/src/audio.rs
@crates/trustedge-cli/src/main.rs
@scripts/ci-check.sh
@.github/workflows/ci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean up ambiguous stub terminology and confirm zero unimplemented TODOs</name>
  <files>
    crates/core/src/audio.rs
    crates/trustedge-cli/src/main.rs
  </files>
  <action>
    **Step 1: Confirm zero unimplemented TODOs.**
    Run `grep -rn "// TODO\|// FIXME\|// HACK\|// XXX\|todo!\|unimplemented!" crates/ --include="*.rs"` and verify zero matches. This confirms phases 19-22 cleaned everything.

    **Step 2: Rename "stub" doc-comments in audio.rs to "feature-disabled" terminology.**
    The `#[cfg(not(feature = "audio"))]` block in `crates/core/src/audio.rs` (lines ~381-444) uses "stub" in doc-comments and code comments. This is a properly designed fail-closed feature gate (returns errors when audio is not compiled in), NOT a placeholder/stub. Rename for clarity:

    - Line 381: `// Stub implementation when audio feature is not available` -> `// Feature-disabled implementation: returns errors when audio feature is not compiled`
    - Line 383: `/// Stub audio capture (audio feature not enabled)` -> `/// Audio capture (feature-disabled: returns errors when audio feature is not compiled)`
    - Lines 390, 401, 408, 415, 422, 427, 434, 441: Replace `(stub)` suffix in doc-comments with `(feature-disabled)` suffix
    - Line 497 test name: `test_audio_stub` -> `test_audio_feature_disabled`

    **Step 3: Rename "stub" doc-comment in CLI.**
    `crates/trustedge-cli/src/main.rs` line 298: `/// List available audio input devices (stub when audio not available)` -> `/// List available audio input devices (feature-disabled: provides guidance when audio not compiled)`

    **Step 4: Clarify inline comment in CLI encrypt function.**
    `crates/trustedge-cli/src/main.rs` line 969: `// header fields (demo placeholders as needed)` -> `// header fields (randomly generated per session)`

    Do NOT modify `crates/core/src/archive.rs` test fixtures — "placeholder" strings in test data are immediately overwritten with computed values and are explicitly out of scope.

    Do NOT modify `crates/core/src/applications/attestation/mod.rs` — the "placeholder" comment is describing feature-gated behavior and is accurate.
  </action>
  <verify>
    1. `grep -rn "stub" crates/core/src/audio.rs crates/trustedge-cli/src/main.rs` returns zero matches (all renamed to feature-disabled)
    2. `grep -rn "// TODO\|// FIXME\|// HACK\|// XXX" crates/ --include="*.rs"` returns zero matches
    3. `cargo test -p trustedge-core --lib` passes (renamed test function works)
    4. `cargo clippy -p trustedge-core -p trustedge-cli --no-default-features -- -D warnings` passes
  </verify>
  <done>
    Zero "stub" references remain in audio.rs and CLI main.rs. Zero unimplemented TODO/FIXME/HACK/XXX comments exist in codebase. All doc-comments accurately describe fail-closed feature-disabled behavior. Tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add TODO hygiene CI check to prevent regression</name>
  <files>
    scripts/ci-check.sh
    .github/workflows/ci.yml
  </files>
  <action>
    **Step 1: Add TODO hygiene check to ci-check.sh.**
    Insert a new step after Step 1 (Copyright headers) and before Step 2 (Security audit). This shifts all subsequent step numbers up by 1.

    Actually, to avoid renumbering all steps, insert the TODO hygiene check as "Step 1b" or append it after the existing Step 21 as "Step 22". The cleaner approach: add it as the LAST check before the summary block, as a new Step 22.

    Add this step to `scripts/ci-check.sh` before the Summary section (before line 340):

    ```bash
    # ── Step 22: TODO hygiene ──────────────────────────────────────────
    step "Step 22: TODO hygiene (no unimplemented markers)"
    # Scan for TODO/FIXME/HACK/XXX comments that indicate unimplemented functionality
    # Excludes: test fixtures, planning docs, target dir, .git dir
    todo_count=0
    while IFS= read -r match; do
        # Skip test-only placeholder data (e.g., continuity_hash in test fixtures)
        case "$match" in
            *"#[cfg(test)]"*) continue ;;
            *"_test_"*|*"test_"*) continue ;;
        esac
        echo "  Found: $match"
        todo_count=$((todo_count + 1))
    done < <(grep -rn '// TODO\|// FIXME\|// HACK\|// XXX\|todo!()\|unimplemented!()' \
        --include="*.rs" crates/ \
        2>/dev/null || true)
    if [ "$todo_count" -gt 0 ]; then
        fail "$todo_count unimplemented TODO/FIXME markers found"
    else
        pass "No unimplemented TODO/FIXME markers"
    fi
    ```

    **Step 2: Add TODO hygiene check to .github/workflows/ci.yml.**
    Add a new job step after the "Copyright headers" step (after line 53, before the "fmt" step). This runs early in the pipeline to fail fast:

    ```yaml
      - name: TODO hygiene (no unimplemented markers)
        run: |
          # Scan for TODO/FIXME/HACK/XXX that indicate unimplemented functionality
          count=$(grep -rn '// TODO\|// FIXME\|// HACK\|// XXX\|todo!()\|unimplemented!()' \
            --include="*.rs" crates/ 2>/dev/null | wc -l || echo 0)
          if [ "$count" -gt 0 ]; then
            echo "::error::Found $count unimplemented TODO/FIXME/HACK/XXX markers in crates/"
            grep -rn '// TODO\|// FIXME\|// HACK\|// XXX\|todo!()\|unimplemented!()' \
              --include="*.rs" crates/ || true
            exit 1
          fi
          echo "No unimplemented TODO/FIXME markers found"
    ```

    **Important:** Both checks scan for the SAME patterns: `// TODO`, `// FIXME`, `// HACK`, `// XXX`, `todo!()`, `unimplemented!()`. This ensures the local script and CI enforce the same policy.

    Note: `todo!()` and `unimplemented!()` are Rust macros that panic at runtime — they should never be in production code. The scan catches these as well as comment-based markers.
  </action>
  <verify>
    1. `bash scripts/ci-check.sh 2>&1 | grep -A1 "Step 22"` shows "TODO hygiene" step passing
    2. The CI workflow YAML is valid: `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/ci.yml'))"` exits 0
    3. Verify the grep pattern catches known bad patterns: `echo '// TODO: implement this' | grep '// TODO'` matches
    4. Verify the grep pattern does NOT match safe patterns: `echo '// Removed per TODO hygiene sweep' | grep '// TODO'` should NOT match (it won't because the pattern requires `// TODO` which differs from `// Removed per TODO`)
  </verify>
  <done>
    CI (both local script and GitHub workflow) scans for unimplemented TODO/FIXME/HACK/XXX markers on every run. Any new TODO comment or todo!() macro in crates/ causes CI failure. Local ci-check.sh and GitHub Actions enforce the same policy.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "// TODO\|// FIXME\|// HACK\|// XXX\|todo!()\|unimplemented!()" crates/ --include="*.rs"` returns zero matches
2. `grep -rn "stub" crates/core/src/audio.rs crates/trustedge-cli/src/main.rs` returns zero matches
3. `cargo test --workspace --no-default-features --locked` passes
4. `cargo clippy --workspace --no-default-features -- -D warnings` passes (or tiered equivalent)
5. `bash scripts/ci-check.sh` passes including the new TODO hygiene step
6. `.github/workflows/ci.yml` includes TODO hygiene step
</verification>

<success_criteria>
- Zero TODO/FIXME/HACK/XXX comments indicating unimplemented functionality in any .rs file under crates/
- All feature-disabled code paths use "feature-disabled" terminology instead of "stub"
- CI (local + GitHub) enforces TODO hygiene on every push/PR
- All existing tests continue to pass
- This is the final phase of v1.4 — milestone complete after this plan executes
</success_criteria>

<output>
After completion, create `.planning/phases/23-todo-hygiene-sweep/23-01-SUMMARY.md`
</output>
